FROM eclipse-temurin:25-jdk

ARG TARGETARCH

RUN mkdir /app /jeffrey-libs

# All arch variants are in the build context; TARGETARCH picks the right one
COPY jeffrey.jar /app/
COPY jeffrey-cli-${TARGETARCH} /jeffrey-libs/jeffrey-cli
COPY libasyncProfiler-${TARGETARCH}.so /jeffrey-libs/libasyncProfiler.so

RUN chmod +x /jeffrey-libs/jeffrey-cli

ENTRYPOINT ["java", "-jar", "/app/jeffrey.jar"]
