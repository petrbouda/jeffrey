FROM eclipse-temurin:25-jdk

ARG TARGETARCH

RUN mkdir /app /jeffrey-libs

COPY jeffrey.jar /app/
COPY jeffrey-cli.jar /jeffrey-libs/jeffrey-cli.jar
COPY jeffrey-cli-${TARGETARCH} /jeffrey-libs/jeffrey-cli-${TARGETARCH}
COPY libasyncProfiler-${TARGETARCH}.so /jeffrey-libs/libasyncProfiler.so
COPY jeffrey-agent-*.jar /jeffrey-libs/jeffrey-agent.jar

RUN chmod +x /jeffrey-libs/jeffrey-cli-${TARGETARCH}

ENTRYPOINT ["java", "-jar", "/app/jeffrey.jar"]
