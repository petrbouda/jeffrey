#
# Jeffrey
# Copyright (C) 2025 Petr Bouda
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#

# ========================================
# CORS Configuration
# ========================================
# Possible values: DEV, PROD
# DEV: all endpoints (internal + public) allow cross-origin requests (for local development)
# PROD: only /api/public/* endpoints allow cross-origin requests (for Jeffrey-to-Jeffrey communication)
jeffrey.cors.mode=PROD

# ========================================
# Logging Configuration
# ========================================
# Application debug logging - enables request tracing with MDC requestId,
# operation parameters, and duration tracking for expensive operations
# Override via env var: LOGGING_LEVEL_PBOUDA_JEFFREY=DEBUG
logging.level.pbouda.jeffrey=DEBUG
jeffrey.logging.http-access.enabled=false
# Starts logging of the JFR events emitted internally by jeffrey application
# currently for HTTP and JDBC events to see latency of processing
jeffrey.logging.jfr-events.application.enabled=true
jeffrey.logging.jfr-events.application.threshold=1s

# ========================================
# Job Scheduler Configuration
# ========================================
jeffrey.job.scheduler.enabled=true

# Default templates and definitions
jeffrey.default-project-templates=classpath:project-templates/default-project-templates.json
jeffrey.default-job-definitions=classpath:job-definitions/default-job-definitions.json

# Job periods (ns, us, ms, s, m, h, d)
jeffrey.job.default.period=1m
jeffrey.job.repository-session-cleaner.period=1m
jeffrey.job.repository-recording-cleaner.period=1m
jeffrey.job.recording-generator.period=1m
jeffrey.job.project-recording-storage-synchronizer.period=5m
jeffrey.job.repository-compression.period=1m

# Projects synchronizer job
jeffrey.job.projects-synchronizer.create-if-not-exists=true
jeffrey.job.projects-synchronizer.period=1m
jeffrey.job.projects-synchronizer.template-id=default-projects-synchronizer-template

# Profiler settings synchronizer job
jeffrey.job.profiler-settings-synchronizer.create-if-not-exists=true
jeffrey.job.profiler-settings-synchronizer.period=10s
jeffrey.job.profiler-settings-synchronizer.max-versions=10

# Workspace events replicator job
jeffrey.job.workspace-events-replicator.create-if-not-exists=true
jeffrey.job.workspace-events-replicator.period=10s

# Orphaned project recording storage cleaner job
jeffrey.job.orphaned-project-recording-storage-cleaner.create-if-not-exists=true
jeffrey.job.orphaned-project-recording-storage-cleaner.period=5m

# ========================================
# Profile Configuration
# ========================================
# Enable the initialization of the newly created profile immediately and asynchronously
jeffrey.profile.data-initializer.enabled=true
jeffrey.profile.data-initializer.blocking=true
jeffrey.profile.data-initializer.concurrent=true

# Frame resolution mode for flamegraph generation
# CACHE: ~10x faster Java-side resolution using in-memory frame cache (default)
# DATABASE: SQL-side frame resolution (original implementation)
jeffrey.profile.frame-resolution=CACHE

# ========================================
# Project/Recording Storage
# ========================================
# Durable place for storing the recordings on filesystem
jeffrey.project.recording-storage.path=${jeffrey.home.dir}/recordings
jeffrey.project.repository-storage.detection.finished-period=30m

# ========================================
# Profiler Agent Settings
# ========================================
# Enable the global settings for all created workspaces and projects
jeffrey.profiler.global-settings.create-if-not-exists=true
jeffrey.profiler.global-settings.command=-agentpath:<<JEFFREY_PROFILER_PATH>>=start,alloc,lock,event=ctimer,loop=15m,chunksize=5m,file=<<JEFFREY_CURRENT_SESSION>>/profile-%t.jfr

# ========================================
# Database Persistence
# ========================================
jeffrey.persistence.database.url=jdbc:duckdb:${jeffrey.home.dir}/jeffrey-data.db
jeffrey.persistence.database.pool-size=25
jeffrey.persistence.database.batch-size=10000

# ========================================
# Copy Libs (Container Deployment)
# ========================================
# Default '/jeffrey-libs' source is located inside the Official Jeffrey Container Image
jeffrey.copy-libs.enabled=false
jeffrey.copy-libs.source=/jeffrey-libs
jeffrey.copy-libs.target=${jeffrey.home.dir}/libs

# ========================================
# HTTP Response Compression
# ========================================
server.compression.enabled=false
server.compression.mime-types=application/json,text/html
server.compression.min-response-size=1024

# ========================================
# AI Model Settings
# ========================================
# AI provider: claude, chatgpt, none (disabled)
jeffrey.ai.provider=claude
# AI model name
# Claude models:  claude-opus-4-5-20251101, claude-sonnet-4-5-20250929, claude-sonnet-4-20250514
# ChatGPT models: gpt-4o, gpt-4o-mini, o3-mini
jeffrey.ai.model=claude-opus-4-5-20251101
# Maximum output tokens for AI responses. Model-specific limits:
# - Claude 3.5 Sonnet: max 8,192 tokens
# - Claude 3.5 Opus: max 16,384 tokens
# - Claude Opus 4.5: max 32,768 tokens
jeffrey.ai.max-tokens=32768
